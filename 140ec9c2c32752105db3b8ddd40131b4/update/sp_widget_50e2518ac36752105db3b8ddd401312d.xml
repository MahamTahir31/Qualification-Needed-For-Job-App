<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_widget">
    <sp_widget action="INSERT_OR_UPDATE">
        <category>custom</category>
        <client_script><![CDATA[function ($scope, $http, spUtil) {
  $scope.data = {
    qualifications: []
  };

  // Example JSON data
  $scope.data.qualifications = [
    {
      regime: 'FCA',
      requestedQualification: 'Unit 1 - UK Regulations',
      status: 'Pending',
      available: 'NO',
      showYesSection: false,
      showNoSection: false,
      selectedAlternative: '',
      alternativeOptions: ['CFA Level 2 & IMC Level 4', 'CFA Level 3', 'FCA']
    },
    {
      regime: 'FCA',
      requestedQualification: 'Unit 2 - Securities',
      status: 'Pending',
      available: 'NO',
      showYesSection: false,
      showNoSection: false,
      selectedAlternative: '',
      alternativeOptions: ['CFA Level 2 & IMC Level 4', 'CFA Level 3', 'FCA']
    },
    {
      regime: 'FCA',
      requestedQualification: 'Unit 3 - Derivatives',
      status: 'Pending',
      available: 'NO',
      showYesSection: false,
      showNoSection: false,
      selectedAlternative: '',
      alternativeOptions: ['CFA Level 2 & IMC Level 4', 'CFA Level 3', 'FCA']
    }
  ];

  // Toggle Yes Section
  $scope.toggleYesSection = function (qualification) {
    qualification.showYesSection = !qualification.showYesSection;
    if (qualification.showYesSection) {
      qualification.showNoSection = false; // Close "No" section if "Yes" is opened
    }
  };

  // Toggle No Section
  $scope.toggleNoSection = function (qualification) {
    qualification.showNoSection = !qualification.showNoSection;
    if (qualification.showNoSection) {
      qualification.showYesSection = false;
      qualification.selectedAlternative = ''; // Reset selected alternative on reopening
    }
  };

  // File Upload Trigger
  $scope.triggerFileUpload = function () {
    document.getElementById('fileInput').click();
  };

      var apiUrl = "/api/now/table/x_1589793_story_i_qualification_data"; // Replace with actual table name

    // Function to Save Form Data
    $scope.saveForm = function () {
        var jsonData = JSON.stringify($scope.data.qualifications); // Convert to JSON string

        var requestData = {
            form_data: jsonData // Store full form data in u_json_data field
        };

        // HTTP POST Request to Save Data
        $http.post(apiUrl, requestData).then(
            function (response) {
                console.log("Data saved successfully:", response.data);
                alert("Form data saved successfully!");
            },
            function (error) {
                console.error("Error while saving:", error);
                alert("Failed to save data. Please check the console.");
            }
        );
    };

}	
]]></client_script>
        <controller_as>c</controller_as>
        <css>.table {
  width: 100%;
  margin: 20px 0;
  border-collapse: collapse;
}

.table th,
.table td {
  padding: 10px;
  text-align: left;
  border: 1px solid #ddd;
}

.table th {
  background-color: #f4f4f4;
  font-weight: bold;
}

.available {
  color: green;
  font-weight: bold;
}

.not-available {
  color: red;
  font-weight: bold;
}

.half-width {
  width: 50%;
 
}

</css>
        <data_table>sp_instance</data_table>
        <demo_data/>
        <description/>
        <docs/>
        <field_list/>
        <has_preview>true</has_preview>
        <id>emp_qualification</id>
        <internal>false</internal>
        <link><![CDATA[function link(scope, element, attrs, controller) {  }]]></link>
        <name>Emp Qualification</name>
        <option_schema/>
        <public>false</public>
        <roles/>
        <script><![CDATA[
]]></script>
        <servicenow>false</servicenow>
        <sys_class_name>sp_widget</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2025-02-07 11:28:33</sys_created_on>
        <sys_id>50e2518ac36752105db3b8ddd401312d</sys_id>
        <sys_mod_count>97</sys_mod_count>
        <sys_name>Emp Qualification</sys_name>
        <sys_package display_value="Story-I Qualification Needed For Job" source="x_1589793_story_i">140ec9c2c32752105db3b8ddd40131b4</sys_package>
        <sys_policy/>
        <sys_scope display_value="Story-I Qualification Needed For Job">140ec9c2c32752105db3b8ddd40131b4</sys_scope>
        <sys_update_name>sp_widget_50e2518ac36752105db3b8ddd401312d</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2025-02-12 09:56:32</sys_updated_on>
        <template><![CDATA[<div class="table-responsive">
  <table class="table table-bordered">
    <thead>
      <tr>
        <th>Regime</th>
        <th>Requested Qualification</th>
        <th>Status</th>
        <th>Qualification Available</th>
      </tr>
    </thead>
    <tbody>
      <tr ng-repeat-start="qualification in data.qualifications">
        <td>{{qualification.regime}}</td>
        <td>{{qualification.requestedQualification}}</td>
        <td>{{qualification.status}}</td>
        <td>
          <button class="btn btn-primary" ng-click="toggleYesSection(qualification)">
            {{qualification.showYesSection ? 'Hide Yes Section' : 'Yes'}}
          </button>
          <button class="btn btn-danger" ng-click="toggleNoSection(qualification)">
            {{qualification.showNoSection ? 'Hide No Section' : 'No'}}
          </button>
        </td>
      </tr>
      
      <tr ng-if="qualification.showYesSection">
<td colspan="4">
<div class="upload-section">
<p class="info-text">Uploads are only needed for exams taken in the last 12 months. If your exam is older, please contact support.</p>
<div class="form-group half-width">
  <label>Qualification Pass Date:</label>
  <input type="date" ng-model="qualification.passDate" class="form-control">
</div>

<div class="form-group m-5">
<label>Upload Qualification Evidence:</label>
<button class="btn btn-primary" ng-click="triggerFileUpload()">Upload File</button>
<input type="file" ng-model="qualification.evidenceFile" class="form-control" style="display: none;" id="fileInput">
<span ng-if="qualification.evidenceFile">File Uploaded: {{qualification.evidenceFile.name}}</span>
</div>
</div>
</td>
</tr>

      <!-- "No" Section -->
      <tr ng-if="qualification.showNoSection" ng-repeat-end>
        <td colspan="4">
          <div class="alternative-options half-width">
            <label>Select Alternative Options</label>
            <select class="form-control" ng-model="qualification.selectedAlternative" ng-options="option for option in qualification.alternativeOptions">
              <option value="">None</option>
            </select>
          </div>

          <!-- Show Alternative Sub-Options When Selected -->
          <div ng-if="qualification.selectedAlternative">
            <h5>Alternative Qualification</h5>
            <div class="form-group half-width ">
              <label>{{qualification.selectedAlternative}} Pass Date:</label>
              <input type="date" ng-model="qualification.passDate" class="form-control">
            </div>
            <div class="form-group">
              <label>Upload Qualification Evidence:</label>
              <button class="btn btn-primary" ng-click="triggerFileUpload()">Upload File</button>
              <input type="file" id="fileInput" class="form-control" style="display: none;" ng-model="qualification.evidenceFile">
              <span ng-if="qualification.evidenceFile">File Uploaded: {{qualification.evidenceFile.name}}</span>
            </div>
          </div>
        </td>
      </tr>
      
      <tr>
      <td>
       <div class="d-flex justify-content-center mt-3">
  <button class="btn btn-success" ng-click="saveForm()">Save</button>
</div>

        </td>
      </tr>

    </tbody>
    
  </table>
</div>]]></template>
    </sp_widget>
</record_update>
